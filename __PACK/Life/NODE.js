Life.ArticleLikeModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={articleId:{notEmpty:!0,id:!0},userId:{notEmpty:!0,id:!0}};return{name:"ArticleLike",methodConfig:{create:{valid:VALID(e)},update:!1,remove:!1}}}}),Life.ArticleModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={boardId:{notEmpty:!0,id:!0},categoryId:{id:!0},writerId:{notEmpty:!0,id:!0},title:{notEmpty:!0,size:{max:255}},content:{size:{max:3e4}},html:!0,viewCount:{notEmpty:!0,integer:!0},lastViewTime:{date:!0},commentCount:{notEmpty:!0,integer:!0},lastCommentTime:{date:!0},likeCount:{notEmpty:!0,integer:!0}};return{name:"Article",initData:{viewCount:0,commentCount:0,likeCount:0},methodConfig:{create:{valid:VALID(e),authKey:"writerId",role:Life.ROLE.USER},update:{valid:VALID(e),authKey:"writerId",role:Life.ROLE.USER},remove:{authKey:"writerId",role:Life.ROLE.USER}}}}}),Life.BoardModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={name:{notEmpty:!0,size:{max:255}},description:{size:{max:3e3}},html:!0,index:{real:!0},lastArticleTime:{date:!0},articleCount:{notEmpty:!0,integer:!0}};return{name:"Board",initData:{articleCount:0},methodConfig:{create:{valid:VALID(e),role:Life.ROLE.MANAGER},update:{valid:VALID(e),role:Life.ROLE.MANAGER},remove:{role:Life.ROLE.MANAGER}}}}}),Life.CategoryModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={boardId:{notEmpty:!0,id:!0},category:{notEmpty:!0,size:{max:255}},lastArticleTime:{date:!0},articleCount:{notEmpty:!0,integer:!0}};return{name:"Category",initData:{articleCount:0},methodConfig:{create:{valid:VALID(e),role:Life.ROLE.MANAGER},update:{valid:VALID(e),role:Life.ROLE.MANAGER},remove:{role:Life.ROLE.MANAGER}}}}}),Life.CommentLikeModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={commentId:{notEmpty:!0,id:!0},userId:{notEmpty:!0,id:!0}};return{name:"CommentLike",methodConfig:{create:{valid:VALID(e)},update:!1,remove:!1}}}}),Life.CommentModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={writerId:{notEmpty:!0,id:!0},articleId:{notEmpty:!0,id:!0},content:{notEmpty:!0,size:{max:1e3}},likeCount:{notEmpty:!0,integer:!0}};return{name:"Comment",initData:{likeCount:0},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)}}}}}),Life.JoinKeyModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";return{name:"JoinKey",methodConfig:{create:!1,update:!1,remove:!1}}}}),Life.SessionKeyModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";return{name:"SessionKey",methodConfig:{create:!1,update:!1,remove:!1}}}}),Life.UserModel=OBJECT({preset:function(){"use strict";return Life.MODEL},params:function(){"use strict";var e={username:{notEmpty:!0,size:{min:4,max:20},username:!0},nickname:{notEmpty:!0,size:{min:2,max:20}},email:{notEmpty:!0,size:{min:5,max:320},email:!0},password:{notEmpty:!0,size:{min:4,max:20}},loginCount:{notEmpty:!0,integer:!0},lastLoginTime:{date:!0},isBanned:{bool:!0},isLeft:{bool:!0},isAgreedTerms:{notEmpty:!0,equal:!0},isAgreedPrivacy:{notEmpty:!0,equal:!0},roles:{array:!0},iconFileId:{id:!0},articleCount:{notEmpty:!0,integer:!0},commentCount:{notEmpty:!0,integer:!0}};return{name:"User",initData:{loginCount:0,articleCount:0,commentCount:0},methodConfig:{create:{valid:VALID(e)},update:{valid:VALID(e)},remove:!1},loginValid:VALID({username:e.username,password:e.password})}}}),Life("ROLE").ADMIN="Admin",Life("ROLE").MANAGER="Manager",Life("ROLE").USER="User";function __responseError(e,_,t,r,n,i){i({statusCode:500,content:'<!doctype html><html><head><meta charset="UTF-8"><title>'+_+"</title></head><body><p><b>"+_+"</b></p><b>path: </b>"+e+" ("+r+":"+n+")"+(void 0===t?"":"<br><b>code: </b>"+t)+"</body></html>",contentType:"text/html"})}function __responseNotFound(e){e({statusCode:404,content:'<!doctype html><html><head><meta charset="UTF-8"><title>Page not found.</title></head><body><p><b>Page not found.</b></p></body></html>',contentType:"text/html"})}Life.MAIN=METHOD({run:function(e){"use strict";var _=require("less"),t=NSP({rootPath:"./Life/view",restURI:["account/create","board","article","user"]});e(t.requestListener),RESOURCE_SERVER.addPreprocessor({extension:"less",preprocessor:function(e,t){_.render(e,function(e,_){t({content:_.css,contentType:"text/css",version:CONFIG.version})})}}),UMAIL.CONNECT_TO_MAIL_SERVER({host:"smtp.gmail.com",port:465,isSecure:!0,username:NODE_CONFIG.Life.email,password:NODE_CONFIG.Life.emailPassword},function(e){Life.sendMail=e})}});var __path=require("path"),__sharedStore=SHARED_STORE("__NSP_SHARED_STORE"),__parseFuncStr=function __parse(__requestInfo,__sourcePath,__source,__response,self,__isNotUsingDCBN){function print(e){void 0!==e&&(__html+="string"==typeof e?e:JSON.stringify(e))}function save(e,_){void 0===_?__sharedStore.remove(e):__sharedStore.save({name:e,value:_})}function load(e){return __sharedStore.get(e)}function cookie(e,_,t,r,n){return void 0===_?(_=__cookieInfo[e],CHECK_IS_DATA(_)===!0?_.value:_):(__newCookieInfo[e]=__cookieInfo[e]={value:_,expireSeconds:t,path:r,domain:n},_)}function upload(e,_){var t,r,n;CHECK_IS_DATA(_)!==!0?t=_:(t=_.success,r=_.error,n=_.overFileSize),UPLOAD_REQUEST({requestInfo:__requestInfo,uploadPath:__path.dirname(__sourcePath)+"/"+e},{error:r,overFileSize:n,success:t})}function redirect(e){__redirectURL=e}function pause(){__pauseCount+=1}var __html="",__redirectURL,__lastIndex=0,__startCodeIndex=-1,__startPstrIndex=-1,__startPstr2Index=-1,__startCondIndex=-1,__startEachIndex=-1,__pauseCount=1,__lastCond,__lastCondStack=[],__isIgnored,__isIgnoreStack=[],__isRepeatStack=[],__repeatInfo,__repeatSplits,__repeatTarget,__repeatTargetName,__repeatTargetNowKey,__repeatTargetBeforeKey,__repeatTargetFirstKey,__repeatItemStr,__repeatItemSplits,__repeatItemName,__repeatItemValue,__cookieInfo=__requestInfo.cookies,__newCookieInfo={},__i,__ch,__line=1,__column=1,__lastLine=1,__lastColumn=1;eval(__resumeFuncStr),resume()}.toString(),__resumeFuncStr=function resume(){DELAY(function(){function include(__uri,__callback){var __fullPath=__path.dirname(__sourcePath)+"/"+__uri,savedLastIndex=__lastIndex;pause(),READ_FILE(__fullPath,{notExists:function(){__responseError(__fullPath,"File not exists.",__source.substring(savedLastIndex,__i-1),__lastLine,__lastColumn,__response)},success:function(__buffer){var ext=__path.extname(__uri).toLowerCase();if(".nsp"===ext)__parse(__requestInfo,__fullPath,__buffer.toString(),function(e){print(e.content),void 0!==__callback&&__callback(),resume()},self,__isNotUsingDCBN);else if(".js"===ext){try{eval(__buffer.toString())}catch(e){return void __responseError(__fullPath,e,__buffer.toString(),1,1,__response)}void 0!==__callback&&__callback(),resume()}else print(__buffer.toString()),resume()}})}if(__pauseCount-=1,0===__pauseCount){for(eval(__parseFuncStr),eval(__resumeFuncStr),__i=__lastIndex;__i<=__source.length;__i+=1){if(__ch=__source[__i],__i>0)if("%"===__ch&&"<"===__source[__i-1])__isIgnored===!0||void 0!==__repeatInfo&&void 0===__repeatInfo.key||-1!==__startCodeIndex||-1!==__startPstrIndex||-1!==__startPstr2Index||-1!==__startCondIndex||-1!==__startEachIndex||("="===__source[__i+1]?(__i>2&&"\\"===__source[__i-3]&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),__startPstr2Index=__i+2):__i>1&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),print(__source.substring(__i-1,__i+2))):(print(__source.substring(__lastIndex,__i-1)),__startPstr2Index=__i+2),__lastIndex=__i+2,__lastLine=__line,__lastColumn=__column-1):(__i>2&&"\\"===__source[__i-3]&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),__startCodeIndex=__i+1):__i>1&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),print(__source.substring(__i-1,__i+1))):(print(__source.substring(__lastIndex,__i-1)),__startCodeIndex=__i+1),__lastIndex=__i+1,__lastLine=__line,__lastColumn=__column-1));else if(">"===__ch&&"%"===__source[__i-1]){if(__isIgnored!==!0&&(void 0===__repeatInfo||void 0!==__repeatInfo.key)&&-1===__startPstrIndex&&-1===__startCondIndex&&-1===__startEachIndex)if(-1!==__startCodeIndex&&-1===__startPstr2Index){try{eval(__source.substring(__lastIndex,__i-1))}catch(e){return void __responseError(__sourcePath,e,__source.substring(__lastIndex,__i-1),__lastLine,__lastColumn,__response)}if(__startCodeIndex=-1,__lastIndex=__i+1,0!==__pauseCount)return void(__column+=1)}else if(-1===__startCodeIndex&&-1!==__startPstr2Index){try{print(eval(__source.substring(__lastIndex,__i-1)))}catch(e){return void __responseError(__sourcePath,e,__source.substring(__lastIndex,__i-1),__lastLine,__lastColumn,__response)}if(__startPstr2Index=-1,__lastIndex=__i+1,0!==__pauseCount)return void(__column+=1)}}else if(__isNotUsingDCBN!==!0&&"{"===__ch&&"{"===__source[__i-1])__isIgnored===!0||void 0!==__repeatInfo&&void 0===__repeatInfo.key||-1!==__startCodeIndex||-1!==__startPstrIndex||-1!==__startPstr2Index||-1!==__startCondIndex||-1!==__startEachIndex||(__i>2&&"\\"===__source[__i-3]&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),__startPstrIndex=__i+1):__i>1&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),print(__source.substring(__i-1,__i+1))):(print(__source.substring(__lastIndex,__i-1)),__startPstrIndex=__i+1),__lastIndex=__i+1,__lastLine=__line,__lastColumn=__column-1);else if("}"===__ch&&"}"===__source[__i-1]){if(__isIgnored!==!0&&(void 0===__repeatInfo||void 0!==__repeatInfo.key)&&-1===__startCodeIndex&&-1!==__startPstrIndex&&-1===__startPstr2Index&&-1===__startCondIndex&&-1===__startEachIndex){try{print(eval(__source.substring(__lastIndex,__i-1)))}catch(e){return void __responseError(__sourcePath,e,__source.substring(__lastIndex,__i-1),__lastLine,__lastColumn,__response)}if(__startPstrIndex=-1,__lastIndex=__i+1,0!==__pauseCount)return void(__column+=1)}}else if("?"===__ch&&"<"===__source[__i-1])void 0!==__repeatInfo&&void 0===__repeatInfo.key||-1!==__startCodeIndex||-1!==__startPstrIndex||-1!==__startPstr2Index||-1!==__startCondIndex||-1!==__startEachIndex||(__isIgnored!==!0?(__i>2&&"\\"===__source[__i-3]&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),__startCondIndex=__i+1):__i>1&&"\\"===__source[__i-2]?(print(__source.substring(__lastIndex,__i-2)),print(__source.substring(__i-1,__i+1))):(print(__source.substring(__lastIndex,__i-1)),__startCondIndex=__i+1),__lastIndex=__i+1,__lastLine=__line,__lastColumn=__column-1):__isIgnoreStack.push(!0));else if(__i>3&&">"===__ch&&"?"===__source[__i-1]&&"/"===__source[__i-2]&&"<"===__source[__i-3])void 0!==__repeatInfo&&void 0===__repeatInfo.key||-1!==__startCodeIndex||-1!==__startPstrIndex||-1!==__startPstr2Index||-1!==__startCondIndex||-1!==__startEachIndex||(__i>5&&"\\"===__source[__i-5]&&"\\"===__source[__i-4]?(__isIgnored!==!0&&print(__source.substring(__lastIndex,__i-4)),__isIgnoreStack.pop(),__isIgnored=__isIgnoreStack[__isIgnoreStack.length-1],__isIgnored!==!0&&(__lastCond=__lastCondStack.pop())):__i>3&&"\\"===__source[__i-4]?(print(__source.substring(__lastIndex,__i-4)),print(__source.substring(__i-3,__i+1))):(__isIgnored!==!0&&print(__source.substring(__lastIndex,__i-3)),__isIgnoreStack.pop(),__isIgnored=__isIgnoreStack[__isIgnoreStack.length-1],__isIgnored!==!0&&(__lastCond=__lastCondStack.pop())),__lastIndex=__i+1);else if("~"===__ch&&"<"===__source[__i-1])__isIgnored!==!0&&-1===__startCodeIndex&&-1===__startPstrIndex&&-1===__startPstr2Index&&-1===__startCondIndex&&-1===__startEachIndex&&(__i>2&&"\\"===__source[__i-3]&&"\\"===__source[__i-2]?((void 0===__repeatInfo||void 0!==__repeatInfo.key)&&print(__source.substring(__lastIndex,__i-2)),__startEachIndex=__i+1):__i>1&&"\\"===__source[__i-2]?(void 0===__repeatInfo||void 0!==__repeatInfo.key)&&(print(__source.substring(__lastIndex,__i-2)),print(__source.substring(__i-1,__i+1))):((void 0===__repeatInfo||void 0!==__repeatInfo.key)&&print(__source.substring(__lastIndex,__i-1)),__startEachIndex=__i+1),__lastIndex=__i+1,__lastLine=__line,__lastColumn=__column-1);else if(__i>3&&">"===__ch&&"~"===__source[__i-1]&&"/"===__source[__i-2]&&"<"===__source[__i-3]){if(__isIgnored!==!0&&-1===__startCodeIndex&&-1===__startPstrIndex&&-1===__startPstr2Index&&-1===__startCondIndex&&-1===__startEachIndex){if(__i>5&&"\\"===__source[__i-5]&&"\\"===__source[__i-4])if(void 0!==__repeatInfo&&void 0!==__repeatInfo.key){__repeatTarget=__repeatInfo.target,__repeatTargetName=__repeatInfo.targetName,__repeatTargetFirstKey=__repeatInfo.key,__repeatItemName=__repeatInfo.name,__repeatItemValue=__repeatInfo.value,print(__source.substring(__lastIndex,__i-4)),__repeatTargetBeforeKey=void 0;for(__repeatTargetNowKey in __repeatTarget)if(__repeatTarget.hasOwnProperty(__repeatTargetNowKey)===!0){if(__repeatTargetBeforeKey===__repeatTargetFirstKey){__repeatInfo.key=__repeatTargetNowKey;break}__repeatTargetBeforeKey=__repeatTargetNowKey}void 0!==__repeatTargetFirstKey&&__repeatTargetNowKey!==__repeatTargetFirstKey?(__i=__repeatInfo.startIndex-1,__line=__repeatInfo.line,__column=__repeatInfo.column,void 0===__repeatItemName?eval(__repeatItemValue+" = "+__repeatTargetName+"['"+__repeatTargetNowKey+"'];"):eval(__repeatItemName+" = '"+__repeatTargetNowKey+"';"+__repeatItemValue+" = "+__repeatTargetName+"['"+__repeatTargetNowKey+"'];")):(__isRepeatStack.pop(),__repeatInfo=__isRepeatStack[__isRepeatStack.length-1])}else __isRepeatStack.pop(),__repeatInfo=__isRepeatStack[__isRepeatStack.length-1];else if(__i>3&&"\\"===__source[__i-4])print(__source.substring(__lastIndex,__i-4)),print(__source.substring(__i-3,__i+1));else if(void 0!==__repeatInfo&&void 0!==__repeatInfo.key){__repeatTarget=__repeatInfo.target,__repeatTargetName=__repeatInfo.targetName,__repeatTargetFirstKey=__repeatInfo.key,__repeatItemName=__repeatInfo.name,__repeatItemValue=__repeatInfo.value,print(__source.substring(__lastIndex,__i-3)),__repeatTargetBeforeKey=void 0;for(__repeatTargetNowKey in __repeatTarget)if(__repeatTarget.hasOwnProperty(__repeatTargetNowKey)===!0){if(__repeatTargetBeforeKey===__repeatTargetFirstKey){__repeatInfo.key=__repeatTargetNowKey;break}__repeatTargetBeforeKey=__repeatTargetNowKey}__repeatTargetNowKey!==__repeatTargetFirstKey?(__i=__repeatInfo.startIndex-1,__line=__repeatInfo.line,__column=__repeatInfo.column,void 0===__repeatItemName?eval(__repeatItemValue+" = "+__repeatTargetName+"['"+__repeatTargetNowKey+"'];"):eval(__repeatItemName+" = '"+__repeatTargetNowKey+"';"+__repeatItemValue+" = "+__repeatTargetName+"['"+__repeatTargetNowKey+"'];")):(__isRepeatStack.pop(),__repeatInfo=__isRepeatStack[__isRepeatStack.length-1])}else __isRepeatStack.pop(),__repeatInfo=__isRepeatStack[__isRepeatStack.length-1];__lastIndex=__i+1}}else if(__i>2&&">"===__ch&&"\\"!==__source[__i-1]&&__isIgnored!==!0&&-1===__startCodeIndex&&-1===__startPstrIndex&&-1===__startPstr2Index)if(void 0!==__repeatInfo&&void 0===__repeatInfo.key||-1===__startCondIndex||-1!==__startEachIndex){if(-1===__startCondIndex&&-1!==__startEachIndex&&"-"!==__source[__i-1]){try{if(__repeatSplits=__source.substring(__lastIndex,__i).split("->"),void 0===__repeatInfo||void 0!==__repeatInfo.key?(__repeatTargetName=__repeatSplits[0],__repeatTarget=eval(__repeatTargetName)):(__repeatTargetName=void 0,__repeatTarget=void 0),__repeatItemStr=__repeatSplits[1],void 0===__repeatTarget)__isRepeatStack.push(__repeatInfo={targetName:__repeatTargetName,value:__repeatItemStr,startIndex:__i+1,line:__line,column:__column});else if(isNaN(__repeatTarget)!==!0&&(__repeatTargetName="__VALUE_ARRAY_"+__VALUE_ARRAY_INDEX,__VALUE_ARRAY_INDEX+=1,__repeatTarget=eval(__repeatTargetName+"="+RUN(function(){var e="[";return REPEAT(__repeatTarget,function(_){_>0&&(e+=","),e+=_}),e+="]"}))),-1===__repeatItemStr.indexOf(":")){__repeatTargetFirstKey=void 0;for(__repeatTargetFirstKey in __repeatTarget)if(__repeatTarget.hasOwnProperty(__repeatTargetFirstKey)===!0)break;__isRepeatStack.push(__repeatInfo={target:__repeatTarget,targetName:__repeatTargetName,key:__repeatTargetFirstKey,value:__repeatItemStr,startIndex:__i+1,line:__line,column:__column}),eval("var "+__repeatItemStr+" = "+__repeatTargetName+"['"+__repeatTargetFirstKey+"'];")}else{__repeatItemSplits=__repeatItemStr.split(":"),__repeatItemName=__repeatItemSplits[0],__repeatItemValue=__repeatItemSplits[1],__repeatTargetFirstKey=void 0;for(__repeatTargetFirstKey in __repeatTarget)if(__repeatTarget.hasOwnProperty(__repeatTargetFirstKey)===!0)break;__isRepeatStack.push(__repeatInfo={target:__repeatTarget,targetName:__repeatTargetName,key:__repeatTargetFirstKey,name:__repeatItemName,value:__repeatItemValue,startIndex:__i+1,line:__line,column:__column}),eval("var "+__repeatItemName+" = '"+__repeatTargetFirstKey+"';var "+__repeatItemValue+" = "+__repeatTargetName+"['"+__repeatTargetFirstKey+"'];")}}catch(e){return void __responseError(__sourcePath,e,__source.substring(__lastIndex,__i),__lastLine,__lastColumn,__response)}if(__startEachIndex=-1,__lastIndex=__i+1,0!==__pauseCount)return void(__column+=1)}}else{try{"else"===__source.substring(__lastIndex,__i).trim()?(__lastCond===!0?(__isIgnored=!0,__isIgnoreStack.push(!0)):__isIgnoreStack.push(!1),__lastCondStack.push(!0)):eval(__source.substring(__lastIndex,__i).replace(/\\>/g,">"))===!1?(__isIgnored=!0,__isIgnoreStack.push(!0),__lastCondStack.push(!1)):(__isIgnoreStack.push(!1),__lastCondStack.push(!0))}catch(e){return void __responseError(__sourcePath,e,__source.substring(__lastIndex,__i),__lastLine,__lastColumn,__response)}if(__startCondIndex=-1,__lastIndex=__i+1,0!==__pauseCount)return void(__column+=1)}"\n"===__ch?(__line+=1,__column=1):__column+=1}-1!==__startCodeIndex||-1!==__startPstrIndex?print(__source.substring(__lastIndex-2)):print(__source.substring(__lastIndex)),void 0!==__redirectURL?__response({statusCode:302,headers:{"Set-Cookie":CREATE_COOKIE_STR_ARRAY(__newCookieInfo),Location:__redirectURL}}):__response({headers:{"Set-Cookie":CREATE_COOKIE_STR_ARRAY(__newCookieInfo)},content:__html,contentType:"text/html"})}})}.toString();global.NSP=function(config){var __VALUE_ARRAY_INDEX=0,rootPath=config.rootPath,restURI=config.restURI,isNotUsingDCBN=config.isNotUsingDCBN,cachedFileInfos={};return eval(__parseFuncStr),{notExistsResource:function(e,_,t){__responseNotFound(t)},requestListener:function(e,_,t,r,n){var i,o,s=e.uri,a="",d=function(){GET_FILE_INFO(i,{notExists:function(){__responseNotFound(_)},success:function(t){var r=cachedFileInfos[i],n={headers:e.headers,method:e.method,params:e.params,ip:e.ip,subURI:a};void 0!==r&&(void 0!==t.lastUpdateTime&&r.lastUpdateTime.getTime()===t.lastUpdateTime.getTime()||void 0!==t.createTime&&r.lastUpdateTime.getTime()===t.createTime.getTime())?__parse(e,i,r.content,_,n,isNotUsingDCBN):READ_FILE(i,{notExists:function(){__responseNotFound(_)},error:function(e){__responseError(i,e,void 0,1,1,_)},success:function(r){var o=r.toString();cachedFileInfos[i]={content:o,lastUpdateTime:void 0===t.lastUpdateTime?t.createTime:t.lastUpdateTime},__parse(e,i,o,_,n,isNotUsingDCBN)}})}})};return""===s&&(s="index.nsp"),i=rootPath+"/"+s,o=__path.extname(s).toLowerCase(),".nsp"===o?(d(),!1):""===o?(NEXT([function(e){CHECK_IS_EXISTS_FILE(i+".nsp",function(_){_===!0?CHECK_IS_FOLDER(i+".nsp",function(_){_===!0?e():(i+=".nsp",d())}):e()})},function(e){return function(){void 0!==restURI?(CHECK_IS_ARRAY(restURI)===!0?CHECK_IS_IN({array:restURI,value:s})===!0?s=restURI+".nsp":EACH(restURI,function(e){return e+"/"===s.substring(0,e.length+1)?(a=s.substring(e.length+1),s=e+".nsp",!1):void 0}):restURI===s?s=restURI+".nsp":restURI+"/"===s.substring(0,restURI.length+1)&&(a=s.substring(restURI.length+1),s=restURI+".nsp"),CHECK_IS_EXISTS_FILE(rootPath+"/"+s,function(_){_===!0?(i=rootPath+"/"+s,d()):e()})):e()}},function(){return function(){CHECK_IS_EXISTS_FILE(i,function(e){e===!0?CHECK_IS_FOLDER(i,function(e){e===!0?(i+="/index.nsp",d()):n()}):n()})}}]),!1):void 0}}},OVERRIDE(Life.ArticleLikeModel,function(e){"use strict";Life.ArticleLikeModel=OBJECT({preset:function(){return e},init:function(e,_,t){e.on("create",{before:function(e,t,r,n){return NEXT([function(_){var t;void 0===n?_():void 0!==n.headers&&void 0!==n.headers.cookie&&(t=PARSE_COOKIE_STR(n.headers.cookie),void 0!==t["session-key"]&&Life.SessionKeyModel.get(t["session-key"],function(t){e.userId=t.userId,_()}))},function(){return function(){_.checkIsExists({filter:{articleId:e.articleId,userId:e.userId}},function(e){e===!0?r({validErrors:{articleId:{type:"existed"}}}):t()})}}]),!1},after:function(e){Life.ArticleModel.updateNoHistory({id:e.articleId,$inc:{likeCount:1}})}}),e.on("remove",{after:function(e){Life.ArticleModel.updateNoHistory({id:e.articleId,$inc:{likeCount:-1}})}})}})}),OVERRIDE(Life.ArticleModel,function(e){"use strict";Life.ArticleModel=OBJECT({preset:function(){return e},init:function(e,_,t){_.getDB().createIndex({boardId:1}),e.on("create",{before:function(e,_,t,r){var n;return void 0===e.content?e.html=void 0:e.html=Markdown.MarkUp(e.content),void 0===r?_():void 0!==r.headers&&void 0!==r.headers.cookie&&(n=PARSE_COOKIE_STR(r.headers.cookie),void 0!==n["session-key"]&&Life.SessionKeyModel.get(n["session-key"],function(t){e.writerId=t.userId,_()})),!1},after:function(e){Life.BoardModel.updateNoHistory({id:e.boardId,lastArticleTime:new Date,$inc:{articleCount:1}}),void 0!==e.categoryId&&Life.CategoryModel.updateNoHistory({id:e.categoryId,lastArticleTime:new Date,$inc:{articleCount:1}})}}),e.on("update",{before:function(e,t,r,n){var i;return e.content===TO_DELETE?e.html=TO_DELETE:void 0!==e.content&&(e.html=Markdown.MarkUp(e.content)),void 0===n?t():void 0!==n.headers&&void 0!==n.headers.cookie&&(i=PARSE_COOKIE_STR(n.headers.cookie),void 0!==i["session-key"]&&Life.SessionKeyModel.get(i["session-key"],function(r){_.get(e.id,function(_){e.writerId===r.userId?t():Life.UserModel.get(r.userId,function(e){CHECK_IS_IN({array:e.roles,value:Life.ROLE.MANAGER})===!0&&t()})})})),!1},after:function(e,_){Life.BoardModel.updateNoHistory({id:e.boardId,$inc:{articleCount:1}}),Life.BoardModel.updateNoHistory({id:_.boardId,$inc:{articleCount:-1}}),void 0!==e.categoryId&&Life.CategoryModel.updateNoHistory({id:e.categoryId,$inc:{articleCount:1}}),void 0!==_.categoryId&&Life.CategoryModel.updateNoHistory({id:_.categoryId,$inc:{articleCount:-1}})}}),e.on("remove",{before:function(e,t,r,n){var i;return void 0===n?t():void 0!==n.headers&&void 0!==n.headers.cookie&&(i=PARSE_COOKIE_STR(n.headers.cookie),void 0!==i["session-key"]&&Life.SessionKeyModel.get(i["session-key"],function(r){_.get(e,function(e){e.writerId===r.userId&&t()})})),!1},after:function(e){Life.BoardModel.updateNoHistory({id:e.boardId,$inc:{articleCount:-1}}),void 0!==e.categoryId&&Life.CategoryModel.updateNoHistory({id:e.categoryId,$inc:{articleCount:-1}})}})}})}),OVERRIDE(Life.BoardModel,function(e){"use strict";Life.BoardModel=OBJECT({preset:function(){return e},init:function(e,_,t){var r,n;e.on("create",{before:function(e,t){return void 0===e.description?e.html=void 0:e.html=Markdown.MarkUp(e.description),_.get({sort:{index:-1}},{notExists:function(){e.index=0,t()},success:function(_){e.index=_.index+1,t()}}),!1}}),e.on("update",{before:function(e,_,t,r){void 0===e.description?e.html=void 0:e.html=Markdown.MarkUp(e.description),void 0!==r&&delete e.index}}),_.moveUp=r=function(e,t){_.get(e,function(e){_.get({filter:{index:{$lt:e.index}},sort:{index:-1}},{notExists:t,success:function(r){var n=r.index;_.updateNoHistory({id:r.id,index:e.index}),_.updateNoHistory({id:e.id,index:n}),t()}})})},_.moveDown=n=function(e,t){_.get(e,function(e){_.get({filter:{index:{$gt:e.index}},sort:{index:1}},{notExists:t,success:function(r){var n=r.index;_.updateNoHistory({id:r.id,index:e.index}),_.updateNoHistory({id:e.id,index:n}),t()}})})}}})}),OVERRIDE(Life.CommentLikeModel,function(e){"use strict";Life.CommentLikeModel=OBJECT({preset:function(){return e},init:function(e,_,t){e.on("create",{before:function(e,t,r,n){return NEXT([function(_){var t;void 0===n?_():void 0!==n.headers&&void 0!==n.headers.cookie&&(t=PARSE_COOKIE_STR(n.headers.cookie),void 0!==t["session-key"]&&Life.SessionKeyModel.get(t["session-key"],function(t){e.userId=t.userId,_()}))},function(){return function(){_.checkIsExists({filter:{commentId:e.commentId,userId:e.userId}},function(e){e===!0?r({validErrors:{commentId:{type:"existed"}}}):t()})}}]),!1},after:function(e){Life.CommentModel.updateNoHistory({id:e.commentId,$inc:{likeCount:1}})}}),e.on("remove",{after:function(e){Life.CommentModel.updateNoHistory({id:e.commentId,$inc:{likeCount:-1}})}})}})}),OVERRIDE(Life.CommentModel,function(e){"use strict";Life.CommentModel=OBJECT({preset:function(){return e},init:function(e,_,t){_.getDB().createIndex({articleId:1}),e.on("create",{before:function(e,_,t,r){var n;return void 0===r?_():void 0!==r.headers&&void 0!==r.headers.cookie&&(n=PARSE_COOKIE_STR(r.headers.cookie),void 0!==n["session-key"]&&Life.SessionKeyModel.get(n["session-key"],function(t){e.writerId=t.userId,_()})),!1},after:function(e){Life.ArticleModel.updateNoHistory({id:e.articleId,lastCommentTime:new Date,$inc:{commentCount:1}})}}),e.on("update",{before:function(e,t,r,n){var i;return void 0===n?t():void 0!==n.headers&&void 0!==n.headers.cookie&&(i=PARSE_COOKIE_STR(n.headers.cookie),void 0!==i["session-key"]&&Life.SessionKeyModel.get(i["session-key"],function(r){_.get(e.id,function(e){e.writerId===r.userId&&t()})})),!1}}),e.on("remove",{before:function(e,t,r,n){var i;return void 0===n?t():void 0!==n.headers&&void 0!==n.headers.cookie&&(i=PARSE_COOKIE_STR(n.headers.cookie),void 0!==i["session-key"]&&Life.SessionKeyModel.get(i["session-key"],function(r){_.get(e,function(e){e.writerId===r.userId&&t()})})),!1},after:function(e){Life.ArticleModel.updateNoHistory({id:e.articleId,$inc:{commentCount:-1}})}})}})}),OVERRIDE(Life.UserModel,function(e){"use strict";Life.UserModel=OBJECT({preset:function(){return e},init:function(e,_,t){var r;e.on("create",{before:function(e,t,r){return _.checkIsExists({filter:{username:e.username}},function(n){n===!0?r({validErrors:{username:{type:"existed"}}}):_.checkIsExists({filter:{nickname:e.nickname}},function(_){_===!0?r({validErrors:{nickname:{type:"existed"}}}):(e.password=SHA256({key:e.username,password:e.password}),delete e.isBanned,delete e.isLeft,e.roles=[Life.ROLE.USER],t())})}),!1},after:function(e){delete e.password,Life.JoinKeyModel.find({filter:{email:e.email},isFindAll:!0},EACH(function(e){Life.JoinKeyModel.remove(e.id)}))}}),e.on("update",{before:function(e,t,r,n){var i;return delete e.email,delete e.isBanned,delete e.isLeft,NEXT([function(_){void 0===n?_():void 0!==n.headers&&void 0!==n.headers.cookie&&(i=PARSE_COOKIE_STR(n.headers.cookie),void 0!==i["session-key"]&&Life.SessionKeyModel.get(i["session-key"],function(t){e.id===t.userId&&_()}))},function(){return function(){_.get(e.id,function(n){NEXT([function(t){e.username===n.username?(void 0!==e.password&&(e.password=SHA256({key:n.username,password:e.password})),t()):void 0!==e.username?_.checkIsExists({filter:{username:e.username}},function(_){_===!0?r({validErrors:{username:{type:"existed"}}}):_===!1&&(void 0!==e.password&&(e.password=SHA256({key:e.username,password:e.password})),t())}):void 0!==e.password?(e.password=SHA256({key:n.username,password:e.password}),t()):t()},function(t){return function(){void 0!==e.nickname&&e.nickname!==n.nickname?_.checkIsExists({filter:{nickname:e.nickname}},function(e){e===!0?r({validErrors:{nickname:{type:"existed"}}}):t()}):t()}},function(){return function(){void 0!==e.iconFileId?IMAGEMAGICK_RESIZE({srcPath:"__RF/Life/"+e.iconFileId,distPath:"__RF/Life/ICON/"+e.iconFileId,width:40,height:40},t):t()}}])})}}]),!1},after:function(e){delete e.password}}),e.on("get",function(e){delete e.password}),e.on("find",EACH(function(e){delete e.password})),_.login=r=function(e,t){_.get({filter:{username:e.username,password:SHA256({key:e.username,password:e.password})}},{notExists:function(){t.notValid()},success:function(e){e.isLeft===!0?t.notValid():Life.SessionKeyModel.create({userId:e.id},function(r){_.updateNoHistory({id:e.id,lastLoginTime:new Date,$inc:{loginCount:1}},function(e){t.success(e,r.id)})})}})}}})});